# ABC215-G

## 1. 問題の言いかえ

列全体で重要なのは、各色のキャンディが何個あるかである。

列全体でのキャンディの種類を $C$ として、$i = 1, 2, \dots C$ について、色 $i$ のキャンディの個数を $n_i$ とする。

色 $i$ について、確率変数 $X_i$ を高橋君が選んだキャンディの中に色 $i$ のキャンディが 1個以上含まれているとき $X_i = 1$ 、そうでないとき $X_i = 0$ となるように定義する。

そうすると、 $K$ 個のキャンディに含まれる色の種類は $\sum_{i = 1}^{C} X_i$ と表せる。求める期待値は、期待値の線形性を用いることで、 $E[\sum_{i = 1}^{C} X_i] = \sum_{i = 1}^{C} E[X_i]$ と書くことができる。

## 2. 高速化

$E[X_i]$ は「$K$ 個のキャンディの中に色 $i$ のキャンディが $1$ 個以上含まれている確率」と等しいので、 $E[X_i] = 1 - \frac{\binom{N - n_i}{K}}{\binom{N}{K}}$ となる。

キャンディの種類数は最大で $N$ であるため、すべての $K = 1,2, \dots, N$ に対してこれを求めようとすると $O(N^2)$ かかり TLEしてしまう。

ここで、 $n_i = n_j$ となるものをまとめて計算してみる。
$x = n_i$ となる $i$ の個数を $a_x$ として表すことで、

$$
\begin{aligned}
    \sum_{i = 1}^{C} E[X_i] &=  \sum_{i = 1}^{C} \left ( 1 - \frac{\binom{N - n_i}{K}}{\binom{N}{K}} \right) \\
    &= \sum_{x = 1}^{N} a_x \left ( 1 - \frac{\binom{N - x}{K}}{\binom{N}{K}} \right) \\
\end{aligned}
$$

$a_x$ が正の値をとるものは、 $O(\sqrt{N})$ 個しかない。

よって、一つの $K$ に対して $O(\sqrt{N})$ で求められるので、全体では $N O(\sqrt{N})$ で解くことができる。
 