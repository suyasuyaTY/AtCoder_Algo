# ABC219-G

## 次数が大きい頂点と小さい頂点で更新方法を分ける

ある定数 $B$ を決め、それより次数が大きいか小さいかで処理を分ける。

### 次数が小さい頂点

頂点 $x_i$ に隣接するすべての頂点について、そこに書かれた整数を $X$ に書き換える。
クエリ $i$ が更新したという情報も記録しておく。計算量は $O(B)$ 。

### 次数が大きい頂点

頂点 $x_i$ に、**「この頂点に隣接するすべての頂点の整数が、クエリ $i$ によって $X$ に書き換えられた。」** というフラグを立てる。
過去のクエリで頂点 $x_i$ にすでに看板が立てられていた場合は、古いフラグを撤去し新しいフラグに書き換える。
計算量は $O(1)$ 。

### 頂点 $x_i$ の値を正しく更新する処理

次数が大きい頂点の更新処理が即時に走らないため、処理の前に隣接する次数の大きい頂点に更新フラグが立っていないかを確認し、クエリの番号を見て正しく処理を入れる必要がある。
次数が $B$ 以上の頂点は高々 $\frac{2M}{B}$ 個しかないことからこの処理にかかる計算時間は、 $O(\frac{M}{B})$ となる。

### 計算量

以上より、一回の処理の最大計算量は $O(B + \frac{M}{B})$ となるため、全体の計算量は $O(Q(B + \frac{M}{B}))$ となる。　$B = \sqrt{M}$ とすれば、 $O(Q \sqrt{M})$
